<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://mindfitness-ai-backend.vercel.app;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <title>Psychoeducation Comics | Mind Fitness</title>
  <meta name="description" content="‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô 6 ‡∏ï‡∏≠‡∏ô">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <link rel="icon" href="../images/logo.jpg">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Sarabun',sans-serif;background:#f8fafc;min-height:100vh}
.site-header{background:white;box-shadow:0 2px 10px rgba(0,0,0,0.08);position:sticky;top:0;z-index:1000}
.header__inner{max-width:1200px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.brand__logo{width:40px;height:40px;border-radius:10px}
.brand__name{font-size:20px;font-weight:700;color:#0B1E47}
.nav__list{display:flex;gap:24px;list-style:none}
.nav__link{text-decoration:none;color:#64748b;font-weight:500}
.nav__link:hover{color:#00A8A8}

.page-hero{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:60px 20px;text-align:center}
.page-hero h1{font-size:32px;margin-bottom:12px}
.page-hero p{opacity:0.9;font-size:16px}

.comics-container{max-width:1000px;margin:40px auto;padding:0 20px}
.comics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:24px}
.comic-card{background:white;border-radius:16px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.08);transition:all 0.3s;cursor:pointer}
.comic-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.12)}
.comic-thumb{height:180px;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:60px}
.comic-info{padding:20px}
.comic-info h3{font-size:18px;color:#0B1E47;margin-bottom:8px}
.comic-info p{color:#64748b;font-size:14px;line-height:1.6}
.comic-badge{display:inline-block;background:#d1fae5;color:#047857;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:600;margin-top:12px}

.comic-viewer{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:white;z-index:9999;overflow-y:auto}
.comic-viewer.active{display:block}
.viewer-header{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10}
.viewer-header h2{font-size:18px}
.close-btn{background:rgba(255,255,255,0.2);border:none;color:white;padding:8px 16px;border-radius:8px;cursor:pointer;font-size:14px}
.close-btn:hover{background:rgba(255,255,255,0.3)}
.viewer-content{max-width:900px;margin:0 auto;padding:20px}
.viewer-content iframe{width:100%;height:80vh;border:none;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.1)}

.loading{text-align:center;padding:60px 20px}
.loading-spinner{width:40px;height:40px;border:3px solid #e2e8f0;border-top-color:#667eea;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}

.no-access{text-align:center;padding:80px 20px}
.no-access h2{color:#0B1E47;margin-bottom:16px}
.no-access p{color:#64748b;margin-bottom:24px}
.btn-primary{display:inline-block;padding:14px 28px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;text-decoration:none;border-radius:10px;font-weight:600}
.btn-primary:hover{opacity:0.9}

@media(max-width:768px){
  .comics-grid{grid-template-columns:1fr}
  .nav__list{display:none}
}
</style>
</head>
<body>
<header class="site-header">
  <div class="header__inner">
    <a class="brand" href="../index.html">
      <img src="../images/logo.jpg" alt="Mind Fitness" class="brand__logo">
      <span class="brand__name">Mind Fitness</span>
    </a>
    <nav>
      <ul class="nav__list">
        <li><a href="../index.html" class="nav__link">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
        <li><a href="../mhl-assessment.html" class="nav__link">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô MHL</a></li>
        <li><a href="index.html" class="nav__link">MindSpace</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="page-hero">
  <h1>Psychoeducation Comics</h1>
  <p>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢</p>
</section>

<div id="loadingSection" class="loading">
  <div class="loading-spinner"></div>
  <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤...</p>
</div>

<div id="noAccessSection" class="no-access" style="display:none">
  <h2>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h2>
  <p>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Psychoeducation Comics ‡∏ó‡∏±‡πâ‡∏á 6 ‡∏ï‡∏≠‡∏ô</p>
  <a href="payment-comic.html" class="btn-primary">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</a>
</div>

<div id="comicsContainer" class="comics-container" style="display:none">
  <div class="comics-grid" id="comicsGrid"></div>
</div>

<div id="comicViewer" class="comic-viewer">
  <div class="viewer-header">
    <h2 id="viewerTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>
    <button class="close-btn" onclick="closeViewer()">‡∏õ‡∏¥‡∏î ‚úï</button>
  </div>
  <div class="viewer-content">
    <iframe id="viewerFrame" src=""></iframe>
  </div>
</div>

<script>
const API_BASE = 'https://mindfitness-ai-backend.vercel.app';

const COMICS = [
  { id: 'vol1', title: 'Vol 1: ‡∏ó‡∏≥‡πÑ‡∏°‡∏ü‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°?', desc: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡πÉ‡∏ô‡πÄ‡∏î‡πá‡∏Å', icon: 'üåßÔ∏è' },
  { id: 'vol2', title: 'Vol 2: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏°‡πÅ‡∏Ç‡πá‡∏á', desc: '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤', icon: 'üíî' },
  { id: 'vol3', title: 'Vol 3: ‡∏ñ‡∏π‡∏Å‡∏Å‡∏•‡∏±‡πà‡∏ô‡πÅ‡∏Å‡∏•‡πâ‡∏á', desc: '‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö Bullying', icon: 'üò¢' },
  { id: 'vol4', title: 'Vol 4: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô', desc: '‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•', icon: 'üò∞' },
  { id: 'vol5', title: 'Vol 5: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô', desc: '‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤', icon: 'ü§ù' },
  { id: 'vol6', title: 'Vol 6: ‡∏Å‡πâ‡∏≤‡∏ß‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∑‡∏î', desc: '‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ß‡∏±‡∏á', icon: 'üåà' }
];

function checkAccess() {
  const saved = localStorage.getItem('comic_access');
  if (!saved) return false;
  try {
    const access = JSON.parse(saved);
    return !!(access.phone || access.tokens);
  } catch (e) {
    return false;
  }
}

function renderComics() {
  const grid = document.getElementById('comicsGrid');
  grid.innerHTML = COMICS.map(comic => `
    <div class="comic-card" onclick="openComic('${comic.id}', '${comic.title}')">
      <div class="comic-thumb">${comic.icon}</div>
      <div class="comic-info">
        <h3>${comic.title}</h3>
        <p>${comic.desc}</p>
        <span class="comic-badge">‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏•‡∏¢</span>
      </div>
    </div>
  `).join('');
}

async function openComic(id, title) {
  document.getElementById('comicViewer').classList.add('active');
  document.getElementById('viewerTitle').textContent = title;

  try {
    const res = await fetch(`${API_BASE}/api/psychoeducation`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'getVolume', volumeId: id })
    });
    const data = await res.json();

    if (data.success && data.content) {
      const frame = document.getElementById('viewerFrame');
      frame.srcdoc = data.content;
    } else {
      alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏î‡πâ');
      closeViewer();
    }
  } catch (e) {
    console.error(e);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
    closeViewer();
  }
}

function closeViewer() {
  document.getElementById('comicViewer').classList.remove('active');
  document.getElementById('viewerFrame').srcdoc = '';
}

// Init
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('loadingSection').style.display = 'none';

  if (checkAccess()) {
    document.getElementById('comicsContainer').style.display = 'block';
    renderComics();
  } else {
    document.getElementById('noAccessSection').style.display = 'block';
  }
});
</script>
</body>
</html>
