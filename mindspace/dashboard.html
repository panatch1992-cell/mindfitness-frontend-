<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https://mindfitness-ai-backend.vercel.app;">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
  <title>Dashboard - Mind Fitness</title>
  <meta name="description" content="Dashboard - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700;900&display=swap" rel="stylesheet">
  <link rel="icon" href="../images/logo.jpg">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Sarabun',sans-serif;background:#f8fafc;min-height:100vh}
.site-header{background:white;box-shadow:0 2px 10px rgba(0,0,0,0.08);position:sticky;top:0;z-index:1000}
.header__inner{max-width:1200px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
.brand{display:flex;align-items:center;gap:10px;text-decoration:none}
.brand__logo{width:40px;height:40px;border-radius:10px}
.brand__name{font-size:20px;font-weight:700;color:#0B1E47}
.back-link{color:#64748b;text-decoration:none;display:flex;align-items:center;gap:6px}
.back-link:hover{color:#00A8A8}

.dashboard-container{max-width:1100px;margin:0 auto;padding:24px 20px}
.dashboard-header{margin-bottom:32px}
.dashboard-header h1{font-size:28px;color:#0B1E47;margin-bottom:8px}
.dashboard-header p{color:#64748b}

.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px}
.stat-card{background:white;border-radius:16px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,0.06)}
.stat-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:16px}
.stat-icon.green{background:#d1fae5}
.stat-icon.blue{background:#dbeafe}
.stat-icon.purple{background:#ede9fe}
.stat-icon.orange{background:#fed7aa}
.stat-value{font-size:32px;font-weight:800;color:#0B1E47;margin-bottom:4px}
.stat-label{color:#64748b;font-size:14px}

.section-title{font-size:20px;color:#0B1E47;margin-bottom:20px;display:flex;align-items:center;gap:10px}

.activity-section{margin-bottom:32px}
.activity-list{background:white;border-radius:16px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.06)}
.activity-item{display:flex;align-items:center;gap:16px;padding:16px 20px;border-bottom:1px solid #f1f5f9}
.activity-item:last-child{border-bottom:none}
.activity-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;background:#f1f5f9}
.activity-content{flex:1}
.activity-content h4{font-size:15px;color:#0B1E47;margin-bottom:2px}
.activity-content p{font-size:13px;color:#64748b}
.activity-time{font-size:12px;color:#94a3b8}

.assessment-section{margin-bottom:32px}
.assessment-card{background:linear-gradient(135deg,#0B1E47,#1e3a5f);color:white;border-radius:16px;padding:32px;display:flex;align-items:center;gap:24px}
.assessment-card img{width:100px;height:100px}
.assessment-info h3{font-size:22px;margin-bottom:8px}
.assessment-info p{opacity:0.8;margin-bottom:16px}
.assessment-btn{display:inline-block;padding:12px 24px;background:#E4AA3A;color:#0B1E47;text-decoration:none;border-radius:25px;font-weight:600}
.assessment-btn:hover{opacity:0.9}

.tools-section{margin-bottom:32px}
.tools-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
.tool-card{background:white;border-radius:16px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,0.06);display:flex;align-items:center;gap:16px;text-decoration:none;transition:all 0.3s}
.tool-card:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.1)}
.tool-icon{width:56px;height:56px;border-radius:14px;background:#f1f5f9;display:flex;align-items:center;justify-content:center}
.tool-icon img{width:36px;height:36px}
.tool-info h4{font-size:16px;color:#0B1E47;margin-bottom:4px}
.tool-info p{font-size:13px;color:#64748b}

.empty-state{text-align:center;padding:60px 20px}
.empty-state img{width:120px;margin-bottom:20px;opacity:0.5}
.empty-state h3{color:#64748b;margin-bottom:8px}
.empty-state p{color:#94a3b8;font-size:14px}

@media(max-width:768px){
  .assessment-card{flex-direction:column;text-align:center}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<header class="site-header">
  <div class="header__inner">
    <a class="brand" href="../index.html">
      <img src="../images/logo.jpg" alt="Mind Fitness" class="brand__logo">
      <span class="brand__name">Mind Fitness</span>
    </a>
    <a href="index.html" class="back-link">‚Üê ‡∏Å‡∏•‡∏±‡∏ö MindSpace</a>
  </div>
</header>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon green">üí¨</div>
      <div class="stat-value" id="chatCount">0</div>
      <div class="stat-label">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢‡∏î‡πå</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon blue">üìù</div>
      <div class="stat-value" id="ventCount">0</div>
      <div class="stat-label">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏¢</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple">üìä</div>
      <div class="stat-value" id="assessmentCount">0</div>
      <div class="stat-label">‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange">üî•</div>
      <div class="stat-value" id="streakDays">0</div>
      <div class="stat-label">‡∏ß‡∏±‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
    </div>
  </div>

  <div class="assessment-section">
    <div class="assessment-card">
      <img src="../images/mind-mascot/mind-thinking.svg" alt="MHL Assessment">
      <div class="assessment-info">
        <h3>‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô MHL-35</h3>
        <p>‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï ‡∏£‡∏±‡∏ö Action Plan ‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
        <a href="../mhl-assessment.html" class="assessment-btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</a>
      </div>
    </div>
  </div>

  <div class="activity-section">
    <h2 class="section-title">üìÖ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
    <div class="activity-list" id="activityList">
      <div class="empty-state">
        <img src="../images/mind-mascot/mind-calm.svg" alt="No Activity">
        <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
        <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô MindSpace ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
      </div>
    </div>
  </div>

  <div class="tools-section">
    <h2 class="section-title">üõ†Ô∏è ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h2>
    <div class="tools-grid">
      <a href="mindbot.html" class="tool-card">
        <div class="tool-icon">
          <img src="../images/mind-mascot/mind-support.svg" alt="‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢‡∏î‡πå">
        </div>
        <div class="tool-info">
          <h4>‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢‡∏î‡πå AI</h4>
          <p>‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö AI ‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á</p>
        </div>
      </a>
      <a href="vent-wall.html" class="tool-card">
        <div class="tool-icon">
          <img src="../images/mind-mascot/mind-vent.svg" alt="Vent Wall">
        </div>
        <div class="tool-info">
          <h4>Vent Wall</h4>
          <p>‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å</p>
        </div>
      </a>
      <a href="comics.html" class="tool-card">
        <div class="tool-icon">
          <img src="../images/mind-mascot/mind-reading.svg" alt="Comics">
        </div>
        <div class="tool-info">
          <h4>Psychoeducation Comics</h4>
          <p>‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô</p>
        </div>
      </a>
    </div>
  </div>
</div>

<script>
// Load stats from localStorage
function loadStats() {
  const chatHistory = JSON.parse(localStorage.getItem('chat_history') || '[]');
  const ventPosts = JSON.parse(localStorage.getItem('vent_posts') || '[]');
  const assessments = JSON.parse(localStorage.getItem('mhl_results') || '[]');
  const lastVisit = localStorage.getItem('last_visit');

  document.getElementById('chatCount').textContent = chatHistory.length;
  document.getElementById('ventCount').textContent = ventPosts.length;
  document.getElementById('assessmentCount').textContent = assessments.length;

  // Calculate streak
  const streak = calculateStreak();
  document.getElementById('streakDays').textContent = streak;

  // Load recent activity
  loadActivity(chatHistory, ventPosts, assessments);

  // Update last visit
  localStorage.setItem('last_visit', new Date().toISOString());
}

function calculateStreak() {
  const visits = JSON.parse(localStorage.getItem('visit_dates') || '[]');
  const today = new Date().toDateString();

  if (!visits.includes(today)) {
    visits.push(today);
    localStorage.setItem('visit_dates', JSON.stringify(visits));
  }

  // Calculate consecutive days
  let streak = 1;
  const sortedVisits = visits.sort((a, b) => new Date(b) - new Date(a));

  for (let i = 1; i < sortedVisits.length; i++) {
    const curr = new Date(sortedVisits[i - 1]);
    const prev = new Date(sortedVisits[i]);
    const diffDays = Math.floor((curr - prev) / (1000 * 60 * 60 * 24));

    if (diffDays === 1) {
      streak++;
    } else {
      break;
    }
  }

  return streak;
}

function loadActivity(chats, vents, assessments) {
  const activities = [];

  chats.forEach(chat => {
    activities.push({
      type: 'chat',
      icon: 'üí¨',
      title: '‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢‡∏î‡πå',
      desc: chat.preview || '‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤',
      time: chat.time || new Date().toISOString()
    });
  });

  vents.forEach(vent => {
    activities.push({
      type: 'vent',
      icon: 'üìù',
      title: '‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô Vent Wall',
      desc: vent.content?.substring(0, 50) + '...' || '‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å',
      time: vent.time || new Date().toISOString()
    });
  });

  assessments.forEach(result => {
    activities.push({
      type: 'assessment',
      icon: 'üìä',
      title: '‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô MHL-35',
      desc: `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${result.score || '-'}`,
      time: result.time || new Date().toISOString()
    });
  });

  // Sort by time
  activities.sort((a, b) => new Date(b.time) - new Date(a.time));

  if (activities.length > 0) {
    const list = document.getElementById('activityList');
    list.innerHTML = activities.slice(0, 10).map(act => `
      <div class="activity-item">
        <div class="activity-icon">${act.icon}</div>
        <div class="activity-content">
          <h4>${act.title}</h4>
          <p>${act.desc}</p>
        </div>
        <div class="activity-time">${timeAgo(act.time)}</div>
      </div>
    `).join('');
  }
}

function timeAgo(date) {
  const now = new Date();
  const diff = Math.floor((now - new Date(date)) / 1000);
  if (diff < 60) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
  if (diff < 3600) return `${Math.floor(diff / 60)} ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
  if (diff < 86400) return `${Math.floor(diff / 3600)} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
  return `${Math.floor(diff / 86400)} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß`;
}

document.addEventListener('DOMContentLoaded', loadStats);
</script>
</body>
</html>
